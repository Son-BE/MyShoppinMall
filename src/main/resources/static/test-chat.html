<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenAI ì±—ë´‡ í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background-color: #f5f5f5;
    }

    .container {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h1 {
      color: #333;
      text-align: center;
    }

    .test-section {
      margin: 30px 0;
      padding: 20px;
      border: 1px solid #e0e0e0;
      border-radius: 5px;
    }

    .test-section h2 {
      color: #555;
      margin-bottom: 15px;
    }

    input, textarea, select {
      width: 100%;
      padding: 10px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
    }

    button {
      background-color: #4CAF50;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background-color: #45a049;
    }

    .response {
      margin-top: 20px;
      padding: 15px;
      background-color: #f9f9f9;
      border-left: 4px solid #4CAF50;
      border-radius: 4px;
      white-space: pre-wrap;
    }

    .error {
      border-left-color: #f44336;
      background-color: #ffebee;
    }

    .loading {
      display: none;
      color: #666;
      font-style: italic;
    }

    .status {
      padding: 10px;
      margin: 10px 0;
      border-radius: 4px;
      text-align: center;
    }

    .status.success {
      background-color: #d4edda;
      color: #155724;
    }

    .status.error {
      background-color: #f8d7da;
      color: #721c24;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸ¤– OpenAI ì±—ë´‡ í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>

  <!-- API ì—°ê²° í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h2>1. API ì—°ê²° í…ŒìŠ¤íŠ¸</h2>
    <button onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
    <div id="connectionStatus" class="status" style="display:none;"></div>
  </div>

  <!-- ê¸°ë³¸ ì±„íŒ… í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h2>2. ê¸°ë³¸ ì±„íŒ… í…ŒìŠ¤íŠ¸</h2>
    <input type="text" id="chatInput" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”..." />
    <button onclick="sendChat()">ì „ì†¡</button>
    <div id="chatLoading" class="loading">ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘...</div>
    <div id="chatResponse" class="response" style="display:none;"></div>
  </div>

  <!-- ì‡¼í•‘ ì–´ì‹œìŠ¤í„´íŠ¸ í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h2>3. ì‡¼í•‘ ì–´ì‹œìŠ¤í„´íŠ¸ í…ŒìŠ¤íŠ¸</h2>
    <textarea id="shoppingInput" rows="3" placeholder="ì‡¼í•‘ ê´€ë ¨ ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...
ì˜ˆ: ê²¨ìš¸ ì½”íŠ¸ ì¶”ì²œí•´ì¤˜"></textarea>
    <button onclick="sendShoppingQuery()">ì§ˆë¬¸í•˜ê¸°</button>
    <div id="shoppingLoading" class="loading">AIê°€ ë‹µë³€ì„ ìƒì„±ì¤‘...</div>
    <div id="shoppingResponse" class="response" style="display:none;"></div>
  </div>

  <!-- ìƒí’ˆ ì¶”ì²œ í…ŒìŠ¤íŠ¸ -->
  <div class="test-section">
    <h2>4. ìƒí’ˆ ì¶”ì²œ í…ŒìŠ¤íŠ¸</h2>
    <select id="category">
      <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
      <option value="ì „ìì œí’ˆ">ì „ìì œí’ˆ</option>
      <option value="ì˜ë¥˜">ì˜ë¥˜</option>
      <option value="ê°€ì „ì œí’ˆ">ê°€ì „ì œí’ˆ</option>
      <option value="ìŠ¤í¬ì¸ ìš©í’ˆ">ìŠ¤í¬ì¸ ìš©í’ˆ</option>
    </select>
    <input type="text" id="budget" placeholder="ì˜ˆì‚° (ì˜ˆ: 50ë§Œì›)" />
    <input type="text" id="preference" placeholder="ì„ í˜¸ì‚¬í•­ (ì˜ˆ: ê°€ë²¼ìš´, ì‹¤ìš©ì ì¸)" />
    <button onclick="getRecommendations()">ì¶”ì²œ ë°›ê¸°</button>
    <div id="recommendLoading" class="loading">ì¶”ì²œ ìƒí’ˆì„ ì°¾ëŠ” ì¤‘...</div>
    <div id="recommendResponse" class="response" style="display:none;"></div>
  </div>
</div>

<script>
  const API_BASE = '/api/ai';

  async function testConnection() {
    const statusDiv = document.getElementById('connectionStatus');
    statusDiv.style.display = 'block';
    statusDiv.className = 'status';
    statusDiv.textContent = 'ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...';

    try {
      const response = await fetch(`${API_BASE}/test`);
      const data = await response.json();

      if (response.ok) {
        statusDiv.className = 'status success';
        statusDiv.innerHTML = `
                        âœ… ì—°ê²° ì„±ê³µ!<br>
                        ëª¨ë¸: ${data.model}<br>
                        ë©”ì‹œì§€: ${data.message}
                    `;
      } else {
        statusDiv.className = 'status error';
        statusDiv.textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨: ' + data.message;
      }
    } catch (error) {
      statusDiv.className = 'status error';
      statusDiv.textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨: ' + error.message;
    }
  }

  async function sendChat() {
    const input = document.getElementById('chatInput');
    const loading = document.getElementById('chatLoading');
    const responseDiv = document.getElementById('chatResponse');

    if (!input.value.trim()) {
      alert('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      return;
    }

    loading.style.display = 'block';
    responseDiv.style.display = 'none';

    try {
      const response = await fetch(`${API_BASE}/chat?prompt=${encodeURIComponent(input.value)}`);
      const data = await response.text();

      loading.style.display = 'none';
      responseDiv.style.display = 'block';
      responseDiv.className = 'response';
      responseDiv.textContent = data;
    } catch (error) {
      loading.style.display = 'none';
      responseDiv.style.display = 'block';
      responseDiv.className = 'response error';
      responseDiv.textContent = 'ì˜¤ë¥˜: ' + error.message;
    }
  }

  async function sendShoppingQuery() {
    const input = document.getElementById('shoppingInput');
    const loading = document.getElementById('shoppingLoading');
    const responseDiv = document.getElementById('shoppingResponse');

    if (!input.value.trim()) {
      alert('ì§ˆë¬¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      return;
    }

    loading.style.display = 'block';
    responseDiv.style.display = 'none';

    try {
      const response = await fetch(`${API_BASE}/shopping-assistant`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          message: input.value
        })
      });

      const data = await response.json();

      loading.style.display = 'none';
      responseDiv.style.display = 'block';
      responseDiv.className = 'response';
      responseDiv.textContent = data.response || data.error || 'ì‘ë‹µ ì—†ìŒ';
    } catch (error) {
      loading.style.display = 'none';
      responseDiv.style.display = 'block';
      responseDiv.className = 'response error';
      responseDiv.textContent = 'ì˜¤ë¥˜: ' + error.message;
    }
  }

  async function getRecommendations() {
    const category = document.getElementById('category').value;
    const budget = document.getElementById('budget').value;
    const preference = document.getElementById('preference').value;
    const loading = document.getElementById('recommendLoading');
    const responseDiv = document.getElementById('recommendResponse');

    if (!category && !budget && !preference) {
      alert('ìµœì†Œí•œ í•˜ë‚˜ì˜ ì¡°ê±´ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!');
      return;
    }

    loading.style.display = 'block';
    responseDiv.style.display = 'none';

    try {
      const response = await fetch(`${API_BASE}/recommend`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          category: category,
          budget: budget,
          preference: preference
        })
      });

      const data = await response.json();

      loading.style.display = 'none';
      responseDiv.style.display = 'block';
      responseDiv.className = 'response';
      responseDiv.textContent = data.recommendations || 'ì¶”ì²œ ê²°ê³¼ ì—†ìŒ';
    } catch (error) {
      loading.style.display = 'none';
      responseDiv.style.display = 'block';
      responseDiv.className = 'response error';
      responseDiv.textContent = 'ì˜¤ë¥˜: ' + error.message;
    }
  }
</script>
</body>
</html>