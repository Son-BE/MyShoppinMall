<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내 정보 | SonStarMall</title>

    <!-- Font Awesome & Google Font -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          crossorigin="anonymous"/>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="/css/profile_view.css">
</head>

<body>
<!-- Header - 메인 페이지와 동일 -->
<header class="header" role="banner">
    <div class="header-content">
        <h1 class="logo"
            onclick="window.location.href='/'"
            tabindex="0"
            role="button"
            aria-label="SonStarMall 홈으로 이동"
            onkeypress="if(event.key==='Enter') window.location.href='/'">
            SonStarMall
        </h1>

        <nav class="header-nav" aria-label="주요 메뉴">
            <a href="/items" class="header-nav-link">
                <i class="fa-solid fa-box" aria-hidden="true"></i>
                <span>전체상품</span>
            </a>
            <a href="/orders/myOrder" class="header-nav-link">
                <i class="fa-solid fa-receipt" aria-hidden="true"></i>
                <span>주문내역</span>
            </a>
            <a href="/board?category=NOTICE" class="header-nav-link">
                <i class="fa-solid fa-comments" aria-hidden="true"></i>
                <span>게시판</span>
            </a>
        </nav>

        <div class="header-search">
            <form method="get" action="/search" role="search">
                <i class="fa-solid fa-search search-icon" aria-hidden="true"></i>
                <input type="text"
                       name="query"
                       class="search-input"
                       placeholder="상품을 검색하세요..."
                       aria-label="상품 검색"
                       required>
            </form>
        </div>

        <nav class="header-actions" aria-label="사용자 메뉴">
            <div th:if="${#authorization.expression('isAuthenticated()')}" class="user-info">
                <a th:href="@{/user/cart}" class="auth-button" aria-label="장바구니">
                    <i class="fa-solid fa-cart-shopping" aria-hidden="true"></i>
                    <span>장바구니</span>
                </a>

                <a th:href="@{/user/wishList}" class="auth-button" aria-label="찜 목록">
                    <i class="fa-solid fa-heart" aria-hidden="true"></i>
                    <span>찜 목록</span>
                </a>

                <a th:href="@{/members/profile}" class="auth-button" aria-label="프로필 페이지 이동">
                    <i class="fa-solid fa-user" aria-hidden="true"></i>
                    <span th:text="${#authentication.name}">사용자</span>
                </a>

                <form th:action="@{/logout}" method="post" style="display:inline;">
                    <input type="hidden"
                           th:if="${_csrf != null}"
                           th:name="${_csrf.parameterName}"
                           th:value="${_csrf.token}" />
                    <button type="submit" class="auth-button logout-button" aria-label="로그아웃">
                        <i class="fa-solid fa-right-from-bracket" aria-hidden="true"></i>
                        <span>로그아웃</span>
                    </button>
                </form>
            </div>

            <div th:unless="${#authorization.expression('isAuthenticated()')}" class="user-info">
                <a th:href="@{/login}" class="auth-button" aria-label="로그인">
                    <i class="fa-solid fa-right-to-bracket" aria-hidden="true"></i>
                    <span>로그인</span>
                </a>
                <a th:href="@{/signup}" class="auth-button" aria-label="회원가입">
                    <i class="fa-solid fa-user-plus" aria-hidden="true"></i>
                    <span>회원가입</span>
                </a>
            </div>
        </nav>
    </div>
</header>

<!-- Main Content -->
<div class="content-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="member-badge">
            <i class="fa-solid fa-crown"></i>
            SonStar 회원
        </div>
        <h1 class="page-title">
            <i class="fa-solid fa-user-circle"></i>
            내 정보
        </h1>
        <p class="page-subtitle">회원님의 소중한 정보를 안전하게 관리하고 있습니다</p>
    </div>

    <!-- Profile Stats -->
    <div class="profile-stats">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fa-solid fa-coins"></i>
            </div>
            <div class="stat-value" th:text="${member.point}">0</div>
            <div class="stat-label">보유 포인트</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fa-solid fa-calendar-days"></i>
            </div>
            <div class="stat-value" th:text="${#temporals.format(member.createdAt, 'yyyy.MM.dd')}">2024.01.01</div>
            <div class="stat-label">가입일</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fa-solid fa-shopping-bag"></i>
            </div>
            <div class="stat-value">0</div>
            <div class="stat-label">총 주문수</div>
        </div>
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fa-solid fa-heart"></i>
            </div>
            <div class="stat-value">0</div>
            <div class="stat-label">찜한 상품</div>
        </div>
    </div>

    <!-- Info Cards -->
    <div class="info-cards">
        <!-- 내 정보 -->
        <section class="info-card">
            <h2>
                <i class="fa-solid fa-id-card"></i>
                개인 정보
            </h2>
            <div class="info-list">
                <div class="info-item">
                    <label>
                        <i class="fa-solid fa-envelope"></i>
                        이메일
                    </label>
                    <p th:text="${member.email}">example@email.com</p>
                </div>
                <div class="info-item">
                    <label>
                        <i class="fa-solid fa-user"></i>
                        닉네임
                    </label>
                    <p th:text="${member.nickName}">사용자닉네임</p>
                </div>
                <div class="info-item">
                    <label>
                        <i class="fa-solid fa-venus-mars"></i>
                        성별
                    </label>
                    <p th:text="${member.gender}">남성</p>
                </div>
                <div class="info-item">
                    <label>
                        <i class="fa-solid fa-phone"></i>
                        전화번호
                    </label>
                    <p th:text="${member.phoneNumber}">010-1234-5678</p>
                </div>
                <div class="info-item">
                    <label>
                        <i class="fa-solid fa-coins"></i>
                        보유 포인트
                    </label>
                    <p class="point-value" th:text="${member.point} + 'P'">1,500P</p>
                </div>
            </div>
        </section>

        <!-- 기본 배송지 -->
        <section class="info-card">
            <h2>
                <i class="fa-solid fa-truck"></i>
                기본 배송지
            </h2>

            <div th:if="${defaultAddress != null}" class="info-list">
                <div class="info-item">
                    <label>
                        <i class="fa-solid fa-user"></i>
                        수령인
                    </label>
                    <p th:text="${defaultAddress.receiverName}">홍길동</p>
                </div>
                <div class="info-item">
                    <label>
                        <i class="fa-solid fa-map-marker-alt"></i>
                        주소
                    </label>
                    <p th:text="${defaultAddress.addr} + ' ' + ${defaultAddress.addrDetail}">서울시 강남구 테헤란로 123, 101호</p>
                </div>
                <div class="info-item">
                    <label>
                        <i class="fa-solid fa-mail-bulk"></i>
                        우편번호
                    </label>
                    <p th:text="${defaultAddress.postalCode}">12345</p>
                </div>
                <div class="info-item">
                    <label>
                        <i class="fa-solid fa-phone"></i>
                        연락처
                    </label>
                    <p th:text="${defaultAddress.receiverPhone}">010-1234-5678</p>
                </div>
                <div class="info-item">
                    <label></label>
                    <a href="/address/manage" class="link-btn">
                        <i class="fa-solid fa-edit"></i>
                        배송지 변경
                    </a>
                </div>
            </div>

            <div th:if="${defaultAddress == null}" class="no-address">
                <i class="fa-solid fa-map-location-dot"></i>
                <p>기본 배송지가 아직 등록되지 않았습니다.</p>
                <a href="/address/manage" class="link-btn">
                    <i class="fa-solid fa-plus"></i>
                    기본 배송지 등록
                </a>
            </div>
        </section>
    </div>

    <!-- Action Buttons -->
    <div class="button-group">
        <button type="button" class="btn btn-primary" onclick="location.href='/members/profile/edit'">
            <i class="fa-solid fa-edit"></i>
            내 정보 수정하기
        </button>
        <button type="button" class="btn btn-secondary" onclick="location.href='/orders/myOrder'">
            <i class="fa-solid fa-list"></i>
            주문 내역 보기
        </button>
        <button type="button" class="btn btn-secondary" onclick="location.href='/user/wishList'">
            <i class="fa-solid fa-heart"></i>
            찜 목록 보기
        </button>
    </div>
</div>

<!-- JavaScript -->
<script>
    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
        // Logo click handler
        const logo = document.querySelector('.logo');
        if (logo) {
            logo.addEventListener('click', function() {
                window.location.href = '/';
            });

            logo.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    window.location.href = '/';
                }
            });
        }

        // Animate stats on page load
        const statValues = document.querySelectorAll('.stat-value');
        statValues.forEach((stat, index) => {
            const finalValue = parseInt(stat.textContent);
            if (isNaN(finalValue)) return;

            let currentValue = 0;
            const increment = finalValue / 50; // 50 steps

            setTimeout(() => {
                const timer = setInterval(() => {
                    currentValue += increment;
                    if (currentValue >= finalValue) {
                        stat.textContent = finalValue;
                        clearInterval(timer);
                    } else {
                        stat.textContent = Math.floor(currentValue);
                    }
                }, 20);
            }, index * 200);
        });

        // Add hover effects to info items
        const infoItems = document.querySelectorAll('.info-item');
        infoItems.forEach(item => {
            item.addEventListener('mouseenter', function() {
                this.style.transform = 'translateX(5px)';
            });

            item.addEventListener('mouseleave', function() {
                this.style.transform = 'translateX(0)';
            });
        });

        // Add click effects to buttons
        const buttons = document.querySelectorAll('.btn');
        buttons.forEach(button => {
            button.addEventListener('click', function(e) {
                const ripple = document.createElement('span');
                ripple.classList.add('ripple');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size/2;
                const y = e.clientY - rect.top - size/2;
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                this.appendChild(ripple);
                setTimeout(() => ripple.remove(), 600);
            });
        });
    });
</script>
</body>
</html>