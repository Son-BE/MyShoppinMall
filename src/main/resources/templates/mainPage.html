<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>SonStarMall</title>

    <!-- Font Awesome & Google Font -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
          crossorigin="anonymous"/>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet"/>
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/header.css">

<style>
    /* 전체 리셋 및 기본 */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Noto Sans KR', sans-serif;
        background-color: #fafafa;
        color: #111;
    }

    /* 헤더 */
    header {
        background-color: #fff;
        position: sticky;
        top: 0;
        z-index: 1000;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
    }

    /* 상단바: 로고 + 유저정보 */
    .top-bar {
        position: relative;
        padding: 20px 40px;
        display: flex;
        justify-content: flex-end;
        align-items: center;
    }

    /* 로고 클릭시 커서 표시 */
    .top-bar h2 {
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        margin: 0; /* 혹시 기본 margin 있다면 제거 */
        font-size: 24px;
        font-weight: 700;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        user-select: none;
        z-index: 10; /* 유저정보 위에 올라오도록 */
    }


    .user-info {
        /* 기존 스타일 유지 */
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: nowrap;
        position: relative; /* z-index 겹침 방지용 */
        z-index: 20;
    }

    /* 내 정보, 로그아웃 버튼 스타일 통일 */
    .logout-button, .login-button {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        font-size: 14px;
        border-radius: 4px;
        cursor: pointer;
        border: 1px solid transparent;
        transition: background-color 0.2s ease, color 0.2s ease;
        white-space: nowrap;
    }

    .login-button {
        background-color: #f6f6f6;
        color: #111;
        border-color: #ccc;
        text-decoration: none;
    }

    .login-button:hover {
        background-color: #eaeaea;
        color: #000;
    }

    .logout-button {
        background-color: #111;
        color: #fff;
        border: none;
    }

    .logout-button:hover {
        background-color: #333;
        color: #fff;
    }

    /* 프로필 내 정보 버튼 */
    .profile-button button.logout-button {
        padding: 6px 12px;
    }

    /* nav 메뉴 (메인 네비게이션) */
    .main-nav {
        display: flex;
        justify-content: center;
        gap: 48px;
        background-color: #fafafa;
        border-top: 1px solid #eee;
        border-bottom: 1px solid #eee;
        padding: 14px 0;
        position: sticky;
        top: 64px; /* 상단바 높이 + 여유 */
        z-index: 900;
    }

    .main-nav a {
        font-size: 15px;
        font-weight: 500;
        color: #111;
        text-decoration: none;
        position: relative;
        padding: 4px 0;
    }

    .main-nav a::after {
        content: '';
        position: absolute;
        bottom: -3px;
        left: 0;
        height: 2px;
        width: 0;
        background-color: #111;
        transition: width 0.3s ease;
    }

    .main-nav a:hover::after,
    .main-nav a.active::after {
        width: 100%;
    }

    /* 필터 폼 */
    .filter-form {
        max-width: 1200px;
        margin: 24px auto 0 auto;
        padding: 20px;
        background-color: #fffdfc;
        border-bottom: 1px solid #e0e0e0;

        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 16px;
    }

    /* 라디오 그룹 정렬 */
    .filter-form > div:first-child {
        display: flex;
        gap: 24px;
    }

    .filter-form label {
        font-size: 14px;
        cursor: pointer;
    }

    /* 셀렉트 박스 그룹 */
    .filter-form > div:last-child {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    /* 셀렉트 박스 스타일 */
    .filter-form select {
        padding: 8px 14px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 6px;
        background-color: #fff;
        cursor: pointer;
        min-width: 160px;
        transition: border-color 0.2s ease;
    }

    .filter-form select:focus {
        outline: none;
        border-color: #111;
    }

    /* 적용 버튼 */
    .filter-form button {
        padding: 10px 24px;
        background-color: #111;
        color: #fff;
        border: none;
        border-radius: 6px;
        font-size: 14px;
        cursor: pointer;
        transition: background-color 0.3s ease;
    }

    .filter-form button:hover {
        background-color: #333;
    }

    /* 상품 그리드 */
    .products-grid {
        max-width: 1200px;
        margin: 24px auto 60px auto;
        padding: 0 20px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 32px;
        background-color: #fefefe;
    }

    /* 상품 카드 */
    .product-card {
        background-color: #fff;
        border: 1px solid #eee;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 0 transparent;
        transition: box-shadow 0.3s ease;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        height: 100%;
    }

    .product-card:hover {
        box-shadow: 0 4px 16px rgba(0,0,0,0.08);
    }

    .product-card a {
        color: inherit;
        text-decoration: none;
        flex-grow: 1;
        display: flex;
        flex-direction: column;
    }

    /* 상품 이미지 */
    .product-card img {
        width: 100%;
        height: 280px;
        object-fit: cover;
        display: block;
        border-bottom: 1px solid #eee;
    }

    /* 상품명 */
    .product-card h3 {
        font-size: 16px;
        font-weight: 500;
        margin: 12px 0 4px 0;
        padding: 0 12px;
    }

    /* 가격 */
    .product-card p {
        font-size: 15px;
        font-weight: 700;
        color: #222;
        padding: 0 12px 12px 12px;
        margin-top: auto;
    }

    /* 페이지네이션 */
    .pagination {
        max-width: 1200px;
        margin: 40px auto 80px auto;
        text-align: center;
        background-color: #fffdfc;
        padding: 12px 0;
    }

    .pagination ul {
        list-style: none;
        display: inline-flex;
        gap: 8px;
        padding: 0;
    }

    .pagination li a {
        display: inline-block;
        padding: 8px 16px;
        border: 1px solid #ccc;
        border-radius: 6px;
        font-size: 14px;
        color: #111;
        text-decoration: none;
        transition: background-color 0.3s ease, color 0.3s ease;
    }

    .pagination li a.active,
    .pagination li a:hover {
        background-color: #111;
        color: #fff;
        border-color: #111;
    }

    /* 알림 메시지 */
    .alert {
        background-color: #ffe0e0;
        color: #c00;
        padding: 14px 24px;
        text-align: center;
        font-weight: 700;
        margin: 20px auto;
        max-width: 800px;
        border-radius: 8px;
        box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }

    /* 사이드 배너 */
    .side-banner {
        position: fixed;
        top: 200px;
        width: 160px;
        padding: 16px 12px;
        background-color: #fff;
        border: 1px solid #eee;
        box-shadow: 0 0 8px rgba(0,0,0,0.05);
        font-size: 14px;
        text-align: center;
        z-index: 100;
        border-radius: 6px;
        line-height: 1.4;
    }

    .left-banner {
        left: 20px;
    }

    .right-banner {
        right: 20px;
    }

    /* 반응형: 사이드 배너 숨김 */
    @media (max-width: 1300px) {
        .side-banner {
            display: none;
        }
    }

    /* 플로팅 박스 (최근 본 상품) */
    .floating-box {
        position: fixed;
        bottom: 50px;
        left: 20px;
        background: #fff;
        padding: 16px 14px;
        border: 1px solid #ddd;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        width: 140px;
        font-family: 'Noto Sans KR', sans-serif;
        z-index: 1000;
    }

    .floating-box h4 {
        font-size: 15px;
        margin-bottom: 10px;
        font-weight: 600;
    }

    /* 모바일 대응 */
    @media (max-width: 768px) {
        .top-bar {
            padding: 16px 20px;
        }

        .main-nav {
            gap: 20px;
            padding: 12px 0;
            flex-wrap: wrap;
        }

        .products-grid {
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            padding: 0 12px;
            gap: 24px;
        }

        .product-card img {
            height: 220px;
        }

        .filter-form {
            flex-direction: column;
            gap: 12px;
            padding: 16px 12px;
        }

        .filter-form > div:last-child {
            justify-content: flex-start;
            gap: 10px;
            flex-wrap: wrap;
        }

        .floating-box {
            left: 10px;
            width: 110px;
            padding: 12px 10px;
        }

        .side-banner {
            display: none;
        }
    }

</style>
</head>
<body>
<header>
    <div class="top-bar">
        <h2 th:onclick="|window.location.href='/items'|" tabindex="0" role="button" aria-label="홈으로 이동">

            SonStarMall
        </h2>
        <div class="user-info">
            <!--로그인 상태-->
            <div th:if="${#authorization.expression('isAuthenticated()')}" class="user-info">
                <span th:text="${#authentication.name} + '님'" style="align-self: center;"></span>

                <a th:href="@{/members/profile}" class="profile-button" aria-label="프로필 페이지 이동">
                    <button type="submit" class="logout-button" aria-label="내 정보">
                        <i class="fa-solid fa-user" aria-hidden="true"></i> 내 정보
                    </button>
                </a>

                <form th:action="@{/logout}" method="post" style="display:inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <button type="submit" class="logout-button" aria-label="로그아웃">
                        <i class="fa-solid fa-right-from-bracket" aria-hidden="true"></i> 로그아웃
                    </button>
                </form>
            </div>

            <!--게스트 유저-->
            <div th:if="${!#authorization.expression('isAuthenticated()')}" style="display: flex; gap: 8px; align-items: center;">
                <a th:href="@{/login}" class="login-button" aria-label="로그인">
                    <i class="fa-solid fa-right-to-bracket" aria-hidden="true"></i> 로그인
                </a>
                <a th:href="@{/signup.html}" class="login-button" aria-label="회원가입">
                    <i class="fa-solid fa-user-plus" aria-hidden="true"></i> 회원가입
                </a>
            </div>


        </div>
    </div>

    <nav class="main-nav">
        <a href="/items"><i class="fa-solid fa-house" aria-hidden="true"></i> Home</a>
        <a href="/user/cart"><i class="fa-solid fa-cart-shopping" aria-hidden="true"></i> 장바구니</a>
        <a href="/user/wishList"><i class="fa-solid fa-heart" aria-hidden="true"></i> 찜 목록</a>
        <a href="/orders/myOrder"><i class="fa-solid fa-book" aria-hidden="true"></i> 주문 내역</a>
        <a href="/board?category=NOTICE"><i class="fa-solid fa-comments" aria-hidden="true"></i> 게시판</a>
    </nav>
</header>
<div th:if="${successMessage}">
    <script>
        alert('[[${successMessage}]]');
    </script>
</div>
<div th:if="${errorMessage}">
    <script>
        alert('[[${errorMessage}]]');
    </script>
</div>

<div th:if="${param.expired}" class="alert" role="alert">
    토큰이 만료되었습니다. 다시 로그인해주세요.
</div>
<div class="side-banner left-banner">신상품 10% 할인!</div>
<div class="side-banner right-banner">추천 상품 보기</div>
<div class="floating-box">
    <h4>최근 본 상품</h4>
    <div id="recent-items-container"></div>
</div>
<div class="side-banner right-banner">
    <!-- Google AdSense  -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-xxxxxxxxxxxxxxxx"
         data-ad-slot="1234567890"
         data-ad-format="auto"
         data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
</div>


<form method="get" action="/items" class="filter-form">
    <div>
        <label><input type="radio" name="gender" value="MALE" th:checked="${selectedGender == 'MALE'}"/> 남성</label>
        <label><input type="radio" name="gender" value="FEMALE" th:checked="${selectedGender == 'FEMALE'}"/> 여성</label>
    </div>
    <div>
        <select name="sort">
            <option value="latest" th:selected="${selectedSort == 'latest'}">최신 등록 상품</option>
            <option value="price low" th:selected="${selectedSort == 'price low'}">가격 낮은순</option>
            <option value="price high" th:selected="${selectedSort == 'price high'}">가격 높은순</option>
            <option value="score high" th:selected="${selectedSort == 'score high'}" disabled>평점 높은순</option>
            <option value="most reviews" th:selected="${selectedSort == 'most reviews'}" disabled>리뷰 많은순</option>
            <option value="popular" th:selected="${selectedSort == 'popular'}" disabled>인기순</option>
        </select>

        <select name="category">
            <optgroup label="상의">
                <option value="hoodie" th:selected="${selectedCategory == 'hoodie'}">후드티</option>
                <option value="tshirt" th:selected="${selectedCategory == 'tshirt'}">티셔츠</option>
                <option value="sweatshirt" th:selected="${selectedCategory == 'sweatshirt'}">맨투맨</option>
            </optgroup>
            <optgroup label="아우터">
                <option value="windbreaker" th:selected="${selectedCategory == 'windbreaker'}">바람막이</option>
                <option value="coat" th:selected="${selectedCategory == 'coat'}">코트</option>
                <option value="padding" th:selected="${selectedCategory == 'padding'}">패딩</option>
            </optgroup>
            <optgroup label="하의">
                <option value="jogger_pants" th:selected="${selectedCategory == 'jogger_pants'}">조거팬츠</option>
                <option value="training_pants" th:selected="${selectedCategory == 'training_pants'}">트레이닝 바지</option>
                <option value="jeans" th:selected="${selectedCategory == 'jeans'}">청바지</option>
            </optgroup>
            <optgroup label="신발">
                <option value="sneakers" th:selected="${selectedCategory == 'sneakers'}">스니커즈</option>
                <option value="running_shoes" th:selected="${selectedCategory == 'running_shoes'}">운동화</option>
                <option value="boots" th:selected="${selectedCategory == 'boots'}">구두</option>
            </optgroup>
            <optgroup label="악세서리">
                <option value="watch" th:selected="${selectedCategory == 'watch'}">시계</option>
                <option value="ring" th:selected="${selectedCategory == 'ring'}">반지</option>
                <option value="necklace" th:selected="${selectedCategory == 'necklace'}">목걸이</option>
            </optgroup>
        </select>
    </div>
    <button type="submit">적용</button>
</form>

<section class="products-grid">
    <div th:if="${#lists.isEmpty(items)}">상품이 없습니다.</div>
    <div th:each="item : ${items}" class="product-card">
        <a th:href="@{/items/detail/{id}(id=${item.id})}">
            <img th:src="${item.imagePath}" onerror="this.src='/images/default.png'"
                 th:alt="${item.itemName} + ' 상품 이미지'"/>
            <h3 th:text="${item.itemName}"></h3>
            <p th:text="${#numbers.formatInteger(item.price, 3, 'COMMA')} + '원'"></p>
        </a>
    </div>
</section>

<nav class="pagination" th:if="${totalPages != null}">
    <ul>
        <li th:if="${currentPage > 0}">
            <a th:href="@{/items(page=${currentPage - 1})}">« 이전</a>
        </li>
        <li th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
            <a th:href="@{/items(page=${i})}" th:text="${i + 1}" th:classappend="${i == currentPage} ? 'active'"></a>
        </li>
        <li th:if="${currentPage < totalPages - 1}">
            <a th:href="@{/items(page=${currentPage + 1})}">다음 »</a>
        </li>
    </ul>
</nav>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const alertBox = document.querySelector('.alert');
        if (alertBox) {
            setTimeout(() => {
                alertBox.style.display = 'none';
            }, 3000);
        }
    });

    setInterval(() => {
        fetch('/ping', {credentials: 'include'}).then(res => {
            if (res.redirected) window.location.href = res.url;
        });
    }, 30000);
</script>

</body>
</html>
